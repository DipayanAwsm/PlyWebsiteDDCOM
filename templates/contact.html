{% extends "base.html" %}

{% block title %}Contact Us - DD and Sons{% endblock %}

{% block content %}
<!-- Contact Header -->
<section class="py-5 bg-primary text-white">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold">Contact Us</h1>
                <p class="lead">Get in touch for the best prices and expert advice</p>
            </div>
        </div>
    </div>
</section>

<!-- Contact Content -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <!-- Contact Form -->
            <div class="col-lg-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-envelope me-2"></i>Send us a Message</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="mb-3">
                                <label for="name" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone">
                            </div>
                            
                            <div class="mb-3">
                                <label for="message" class="form-label">Message *</label>
                                <textarea class="form-control" id="message" name="message" rows="5" required 
                                          placeholder="Tell us about your requirements..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-paper-plane me-2"></i>Send Message
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Contact Information -->
            <div class="col-lg-6">
                <div class="row g-4">
                    <!-- Company Info -->
                    <div class="col-12">
                        <div class="card shadow h-100">
                            <div class="card-header bg-success text-white">
                                <h4 class="mb-0"><i class="fas fa-building me-2"></i>Company Information</h4>
                            </div>
                            <div class="card-body">
                                <h5 class="text-primary mb-4">{{ contact_info.company_name if contact_info else 'DDPlyAndSons' }}</h5>
                                
                                <div class="contact-item mb-4">
                                    <div class="d-flex align-items-center">
                                        <div class="contact-icon me-3">
                                            <i class="fas fa-phone text-success"></i>
                                        </div>
                                        <div>
                                            <strong>Phone</strong><br>
                                            <a href="tel:{{ contact_info.phone if contact_info and contact_info.phone else '+91-9876543210' }}" 
                                               class="text-decoration-none fs-5">
                                                {{ contact_info.phone if contact_info and contact_info.phone else '+91-9876543210' }}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="contact-item mb-4">
                                    <div class="d-flex align-items-center">
                                        <div class="contact-icon me-3">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div>
                                            <strong>Email</strong><br>
                                            <a href="mailto:{{ contact_info.email if contact_info and contact_info.email else 'info@ddandsons.com' }}" 
                                               class="text-decoration-none">
                                                {{ contact_info.email if contact_info and contact_info.email else 'info@ddandsons.com' }}
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Location (Google Maps) -->
                                <div class="contact-item mb-4">
                                    <div class="d-flex align-items-center">
                                        <div class="contact-icon me-3">
                                            <i class="fas fa-map-marker-alt text-danger"></i>
                                        </div>
                                        <div>
                                            <strong>Location</strong><br>
                                            <a href="https://maps.app.goo.gl/wzRyfxHiWatsz4QW7" target="_blank" rel="noopener" class="text-decoration-none">
                                                DDPlyAndSons on Google Maps
                                            </a>
                                            <div class="mt-2">
                                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="showMapQRCode()">
                                                    <i class="fas fa-qrcode me-1"></i>QR Code
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {% if contact_info and contact_info.address %}
                                <div class="contact-item mb-4">
                                    <div class="d-flex align-items-start">
                                        <div class="contact-icon me-3">
                                            <i class="fas fa-map-marker-alt text-danger"></i>
                                        </div>
                                        <div>
                                            <strong>Address</strong><br>
                                            <span class="text-muted">{{ contact_info.address }}</span>
                                            {% if contact_info.latitude and contact_info.longitude %}
                                            <br>
                                            <button class="btn btn-sm btn-outline-primary mt-2" onclick="openGoogleMaps()">
                                                <i class="fas fa-map-marked-alt me-1"></i>View on Map
                                            </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <!-- Quick Contact Actions -->
                                <div class="row g-2 mt-4">
                                    <div class="col-6">
                                        <a href="tel:{{ contact_info.phone if contact_info and contact_info.phone else '+91-9876543210' }}" 
                                           class="btn btn-success w-100">
                                            <i class="fas fa-phone me-2"></i>Call Now
                                        </a>
                                    </div>
                                    <div class="col-6">
                                        <a href="mailto:{{ contact_info.email if contact_info and contact_info.email else 'info@ddandsons.com' }}" 
                                           class="btn btn-primary w-100">
                                            <i class="fas fa-envelope me-2"></i>Email Us
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Business Hours -->
                    <div class="col-12">
                        <div class="card shadow h-100">
                            <div class="card-header bg-info text-white">
                                <h4 class="mb-0"><i class="fas fa-clock me-2"></i>Business Hours</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <strong>Monday - Friday</strong><br>
                                        9:00 AM - 6:00 PM
                                    </div>
                                    <div class="col-6">
                                        <strong>Saturday</strong><br>
                                        9:00 AM - 4:00 PM
                                    </div>
                                </div>
                                <hr>
                                <div class="text-center">
                                    <strong>Sunday</strong><br>
                                    <span class="text-muted">Closed</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Map Section -->
{% if contact_info and contact_info.latitude and contact_info.longitude %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h3 class="text-center mb-4">Find Us</h3>
                <div class="map-container">
                    <div id="map" style="height: 500px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
                </div>
                
                <!-- Navigation Options -->
                <div class="row mt-4">
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-route text-primary display-4 mb-3"></i>
                                <h5>Get Directions</h5>
                                <p class="text-muted">Get turn-by-turn directions to our location</p>
                                <button class="btn btn-primary" onclick="openGoogleMaps()">
                                    <i class="fas fa-map-marked-alt me-2"></i>Open in Google Maps
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-mobile-alt text-success display-4 mb-3"></i>
                                <h5>Call Us</h5>
                                <p class="text-muted">Speak directly with our team</p>
                                <a href="tel:{{ contact_info.phone if contact_info and contact_info.phone else '+91-9876543210' }}" 
                                   class="btn btn-success">
                                    <i class="fas fa-phone me-2"></i>Call Now
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-share-alt text-info display-4 mb-3"></i>
                                <h5>Share Location</h5>
                                <p class="text-muted">Share our location with others</p>
                                <button class="btn btn-info" onclick="shareLocation()">
                                    <i class="fas fa-share me-2"></i>Share Location
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Why Choose Us -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="display-6 fw-bold">Why Choose DD and Sons?</h2>
                <p class="lead text-muted">Your trusted partner for all construction material needs</p>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-medal text-primary display-4 mb-3"></i>
                    <h5>Quality Assurance</h5>
                    <p class="text-muted">We provide only the highest quality materials that meet industry standards.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-dollar-sign text-primary display-4 mb-3"></i>
                    <h5>Competitive Pricing</h5>
                    <p class="text-muted">Get the best value for your money with our competitive pricing.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-handshake text-primary display-4 mb-3"></i>
                    <h5>Trusted Service</h5>
                    <p class="text-muted">Years of experience serving customers with reliable and honest service.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
{% if contact_info and contact_info.latitude and contact_info.longitude %}
<!-- Google Maps API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap"></script>

<script>
let map;
let marker;

function initMap() {
    // Initialize Google Map
    map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: {{ contact_info.latitude }}, lng: {{ contact_info.longitude }} },
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        styles: [
            {
                featureType: 'poi',
                elementType: 'labels',
                stylers: [{ visibility: 'on' }]
            }
        ]
    });

    // Add marker
    marker = new google.maps.Marker({
        position: { lat: {{ contact_info.latitude }}, lng: {{ contact_info.longitude }} },
        map: map,
        title: '{{ contact_info.company_name }}',
        animation: google.maps.Animation.DROP
    });

    // Add info window
    const infoWindow = new google.maps.InfoWindow({
        content: `
            <div style="padding: 10px;">
                <h5 style="margin: 0 0 10px 0; color: #0d6efd;">{{ contact_info.company_name }}</h5>
                <p style="margin: 0 0 5px 0;"><i class="fas fa-map-marker-alt"></i> {{ contact_info.address if contact_info.address else "Our Location" }}</p>
                {% if contact_info.phone %}
                <p style="margin: 0 0 5px 0;"><i class="fas fa-phone"></i> <a href="tel:{{ contact_info.phone }}">{{ contact_info.phone }}</a></p>
                {% endif %}
                {% if contact_info.email %}
                <p style="margin: 0 0 10px 0;"><i class="fas fa-envelope"></i> <a href="mailto:{{ contact_info.email }}">{{ contact_info.email }}</a></p>
                {% endif %}
                <button onclick="openGoogleMaps()" style="background: #0d6efd; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-route"></i> Get Directions
                </button>
            </div>
        `
    });

    marker.addListener('click', function() {
        infoWindow.open(map, marker);
    });

    // Open info window by default
    infoWindow.open(map, marker);
}

// Open Google Maps with directions
function openGoogleMaps() {
    const address = encodeURIComponent('{{ contact_info.address if contact_info.address else "" }}');
    const lat = {{ contact_info.latitude }};
    const lng = {{ contact_info.longitude }};
    
    // Check if user is on mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
        // Open in mobile app
        window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
    } else {
        // Open in web browser
        window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
    }
}

// Share location functionality
function shareLocation() {
    const lat = {{ contact_info.latitude }};
    const lng = {{ contact_info.longitude }};
    const companyName = '{{ contact_info.company_name }}';
    const address = '{{ contact_info.address if contact_info.address else "" }}';
    
    const shareText = `Check out ${companyName} at ${address}. Location: https://www.google.com/maps?q=${lat},${lng}`;
    
    if (navigator.share) {
        // Use native sharing if available
        navigator.share({
            title: `${companyName} - Location`,
            text: shareText,
            url: `https://www.google.com/maps?q=${lat},${lng}`
        });
    } else {
        // Fallback to copying to clipboard
        navigator.clipboard.writeText(shareText).then(function() {
            showNotification('Location copied to clipboard!', 'success');
        }).catch(function() {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = shareText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification('Location copied to clipboard!', 'success');
        });
    }
}

// Show notification function
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(function() {
        const bsAlert = new bootstrap.Alert(notification);
        bsAlert.close();
    }, 3000);
}

// Fallback to Leaflet if Google Maps fails to load
setTimeout(function() {
    if (typeof google === 'undefined' || !google.maps) {
        console.log('Google Maps failed to load, using Leaflet as fallback');
        loadLeafletMap();
    }
}, 5000);

function loadLeafletMap() {
    // Load Leaflet CSS and JS
    const leafletCSS = document.createElement('link');
    leafletCSS.rel = 'stylesheet';
    leafletCSS.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
    document.head.appendChild(leafletCSS);
    
    const leafletJS = document.createElement('script');
    leafletJS.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
    leafletJS.onload = function() {
        // Initialize Leaflet map
        const map = L.map('map').setView([{{ contact_info.latitude }}, {{ contact_info.longitude }}], 15);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);
        
        L.marker([{{ contact_info.latitude }}, {{ contact_info.longitude }}])
            .addTo(map)
            .bindPopup('<b>{{ contact_info.company_name }}</b><br>{{ contact_info.address if contact_info.address else "Our Location" }}')
            .openPopup();
    };
    document.head.appendChild(leafletJS);
}
</script>
{% endif %}
{% endblock %}
